<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contributing &#8212; cdshealpix 0.6.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-astropy.css?v=9d21690f" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css?v=61a4c737" />
    
    <script src="_static/documentation_options.js?v=73d9a94e"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="cdshealpix.ring.vertices_skycoord" href="stubs/cdshealpix.ring.vertices_skycoord.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="index.html"><span id="logotext1">cds</span><span id="logotext2">healpix</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="genindex.html">Index</a></li>
    <li><a title="Module Index" href="py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="stubs/cdshealpix.ring.vertices_skycoord.html" title="cdshealpix.ring.vertices_skycoord">
	  &laquo; previous
	</a>
	
      </li>
      <li>
	<a href="index.html">cdshealpix 0.6.4 documentation</a>
	 &#187;
      </li>
      
      <li>Contributing</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h1>
<p>This section describes how you can contribute to the project. It will require you to install:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.rust-lang.org/learn/get-started">Rustup</a>: the Rust installer and version management tool</p></li>
<li><p><a class="reference external" href="https://github.com/PyO3/maturin">maturin</a> PyPI package, see also on [pypi](<a class="reference external" href="https://pypi.org/project/maturin/">https://pypi.org/project/maturin/</a>)</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/virtualenv/">virtualenv</a> PyPi package</p></li>
<li><p>For running the basic tests: <a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a></p></li>
<li><p>For running the benchmarks: <a class="reference external" href="https://pytest-benchmark.readthedocs.io/en/latest/">pytest_benchmark</a> <a class="reference external" href="https://github.com/astropy/astropy-healpix">astropy_healpix</a></p></li>
</ul>
<section id="compiling-the-cdshealpix-rust-dynamic-library">
<h2>Compiling the cdshealpix Rust dynamic library<a class="headerlink" href="#compiling-the-cdshealpix-rust-dynamic-library" title="Link to this heading">¶</a></h2>
<section id="setting-up-your-development-environment">
<h3>Setting up your development environment<a class="headerlink" href="#setting-up-your-development-environment" title="Link to this heading">¶</a></h3>
<p>If you want to contribute you first must download Rustup:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">&#39;=https&#39;</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</pre></div>
</div>
<p>and follow the installation instructions.</p>
<p>Rustup will allow you to compile the shared library for your local architecture. You will then obtain a .so (Linux/MacOS) or a .pyd (Windows) file that can be loaded and called from python.</p>
<p>Then you can create a new virtual environment (using the virtualenv package) by specifying the version of python you need. Let is call it <code class="docutils literal notranslate"><span class="pre">cdshealpix-env</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>virtualenv
virtualenv<span class="w"> </span>-p<span class="w"> </span>/usr/bin/python3<span class="w"> </span>cdshealpix-env
</pre></div>
</div>
<p>Activate it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>cdshealpix-env/bin/activate
</pre></div>
</div>
<p>Install all the python dependencies and the pre-commits hooks for contributing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>&lt;path_to_cloned_repo&gt;/requirements-dev.txt
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>&lt;path_to_cloned_repo&gt;/requirements-bench.txt
pre-commit<span class="w"> </span>install
</pre></div>
</div>
<p>At this moment you have correctly set up your development environment. When you will be done with your developments, remember to deactivate your environment by typing <code class="docutils literal notranslate"><span class="pre">`deactivate`</span></code>.</p>
<p>The next step tells you how to generate the shared library associated with <code class="docutils literal notranslate"><span class="pre">cdshealpix</span></code>.</p>
</section>
<section id="dynamic-library-compilation">
<h3>Dynamic library compilation<a class="headerlink" href="#dynamic-library-compilation" title="Link to this heading">¶</a></h3>
<p>The generation of the shared library is managed by [maturin](<a class="reference external" href="https://github.com/PyO3/maturin">https://github.com/PyO3/maturin</a>). Just go to the root of your cloned repo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>&lt;path_to_cloned_repo&gt;
</pre></div>
</div>
<p>and run this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>maturin
maturin<span class="w"> </span>develop<span class="w"> </span>--release
</pre></div>
</div>
<p>The generated .so will be located in a target/release folder. Just copy it from target/release to cdshealpix:</p>
<p>You do not have to recompile the dynamic library every time if you just work on the python-side code. It is only necessary if you want to update the Rust code located in src/lib.rs.</p>
<p>Remark: if you pull a new version and get errors, you may have to remove <code class="docutils literal notranslate"><span class="pre">Cargo.lock</span></code> before executing <code class="docutils literal notranslate"><span class="pre">maturin</span> <span class="pre">develop</span> <span class="pre">--release</span></code>.</p>
</section>
</section>
<section id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="Link to this heading">¶</a></h2>
<p>For running the tests + benchmarks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>python
python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>cdshealpix
</pre></div>
</div>
<p>For running only the benchmarks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>python
python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>cdshealpix/tests/test_benchmark_healpix.py
<span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
</section>
<section id="working-on-the-documentation">
<h2>Working on the documentation<a class="headerlink" href="#working-on-the-documentation" title="Link to this heading">¶</a></h2>
<p>To work on the documentation you have to install a few more packages:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.sphinx-doc.org/en/master/">sphinx</a> is responsible for building the documentation in HTML.</p></li>
<li><p><a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html">numpydoc</a> defines a very convenient way to write API documentation by introducing the numpy docstring format.</p></li>
<li><p><a class="reference external" href="https://sphinxcontrib-bibtex.readthedocs.io/en/latest/">sphinxcontrib-bibtex</a> allows to add bibtex references to the documentation.</p></li>
<li><p><a class="reference external" href="https://mocpy.readthedocs.io/en/latest/">mocpy</a> is used to generate plots of the HEALPix cells obtained.</p></li>
<li><p><a class="reference external" href="https://matplotlib.org/">matplotlib</a> is used by <code class="docutils literal notranslate"><span class="pre">mocpy</span></code> for plotting purposes.</p></li>
</ul>
<p>These packages can be installed via pip but are already referred in <code class="docutils literal notranslate"><span class="pre">requirements-doc.txt</span></code>. So if you did a:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>&lt;path_to_cloned_repo&gt;/requirements-doc.txt
</pre></div>
</div>
<p>Then they are already installed.</p>
<p>To build the documentation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>docs
make<span class="w"> </span>html
make<span class="w"> </span>doctest
<span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
<p>The HTML files can then be consulted:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>firefox<span class="w"> </span>docs/_build/html/index.html<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Contributing</a><ul>
<li><a class="reference internal" href="#compiling-the-cdshealpix-rust-dynamic-library">Compiling the cdshealpix Rust dynamic library</a><ul>
<li><a class="reference internal" href="#setting-up-your-development-environment">Setting up your development environment</a></li>
<li><a class="reference internal" href="#dynamic-library-compilation">Dynamic library compilation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-tests">Running the tests</a></li>
<li><a class="reference internal" href="#working-on-the-documentation">Working on the documentation</a></li>
</ul>
</li>
</ul>


  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="stubs/cdshealpix.ring.vertices_skycoord.html"
                          title="previous chapter">cdshealpix.ring.vertices_skycoord</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/contribute.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<form action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="_sources/contribute.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, Matthieu Baumann &lt;matthieu.baumann@astro.unistra.fr&gt; F.-X. Pineau &lt;francois-xavier.pineau@astro.unistra.fr&gt;.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
  </p>
</footer>
  </body>
</html>